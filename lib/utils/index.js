import { e2a } from './convert';
/**
 * Common utility functions
 */
/**
 * Simple debounce; useful when no stream is at play
 */
export function debounce(func, wait, immediate) {
    if (wait === void 0) { wait = 0; }
    if (immediate === void 0) { immediate = false; }
    var timeout = null;
    return function () {
        var context = this;
        var args = arguments;
        var callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(function () {
            timeout = null;
            if (!immediate)
                func.apply(context, args);
        }, wait);
        if (callNow)
            func.apply(context, args);
    };
}
/**
 * Deep copy an object, albeit not terribly efficiently
 */
export function deepCopy(obj) {
    return JSON.parse(JSON.stringify(obj));
}
/**
 * Dump buffer
 */
export function dump(data, title, ebcdic, color) {
    if (ebcdic === void 0) { ebcdic = false; }
    if (color === void 0) { color = 'blue'; }
    var sliceSize = 32;
    var offset = 0;
    var total = data.length;
    console.groupCollapsed("%c" + title + " " + (ebcdic ? '(EBCDIC-encoded)' : ''), "color: " + color);
    console.log('%c      00       04       08       0c       10       14       18       1c        00  04  08  0c  10  14  18  1c  ', 'font-weight: bold');
    while (true) {
        var slice = new Uint8Array(data.slice(offset, Math.min(offset + sliceSize, total)));
        var _a = dumpSlice(slice, sliceSize, ebcdic), hex = _a.hex, str = _a.str;
        console.log("%c" + toHex(offset, 4) + ": %c" + hex + " %c" + str, 'font-weight: bold', 'color: black', 'color: grey');
        // setup for next time
        if (slice.length < sliceSize)
            break;
        offset += sliceSize;
    }
    console.groupEnd();
}
function dumpSlice(bytes, sliceSize, ebcdic) {
    var hex = '';
    var str = '';
    var ix = 0;
    // decode to hex and string equiv
    for (; ix < bytes.length; ix++) {
        var byte = bytes[ix];
        hex += "" + toHex(byte, 2);
        var char = ebcdic ? e2a([byte]) : String.fromCharCode(byte);
        // NOTE: use special character in string as a visual aid to counting
        str += ((char === '\u00a0') || (char === ' ')) ? '\u2022' : char;
        if ((ix > 0) && ((ix % 4) === 3))
            hex += ' ';
    }
    // pad remainder of slice
    for (; ix < sliceSize; ix++) {
        hex += '  ';
        str += ' ';
        if ((ix > 0) && ((ix % 4) === 3))
            hex += ' ';
    }
    return { hex: hex, str: str };
}
/**
 * Is this object empty?
 */
export function isObjectEmpty(obj) {
    return (Object.getOwnPropertyNames(obj).length === 0);
}
/**
 * Run code on next tick
 */
export function nextTick(f) {
    setTimeout(f, 0);
}
/**
 * Simple map reversal
 */
export function reverseMap(obj) {
    return Object.keys(obj).reduce(function (acc, k) {
        acc[String(obj[k])] = k;
        return acc;
    }, {});
}
/**
 * Convert to hex, with padding
 */
export function toHex(num, pad) {
    var padding = '0000000000000000'.substring(0, pad);
    var hex = num.toString(16);
    return padding.substring(0, padding.length - hex.length) + hex;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbHMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLFdBQVcsQ0FBQzs7Ozs7OztBQVNoQyxNQUFNLG1CQUFtQixJQUFjLEVBQ2QsSUFBUSxFQUNSLFNBQWlCO0lBRGpCLHFCQUFBLEVBQUEsUUFBUTtJQUNSLDBCQUFBLEVBQUEsaUJBQWlCO0lBQ3hDLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQztJQUNuQixNQUFNLENBQUM7UUFDTCxJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDckIsSUFBTSxJQUFJLEdBQUcsU0FBUyxDQUFDO1FBQ3ZCLElBQU0sT0FBTyxHQUFHLFNBQVMsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUN0QyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdEIsT0FBTyxHQUFHLFVBQVUsQ0FBQztZQUNuQixPQUFPLEdBQUcsSUFBSSxDQUFDO1lBQ2YsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7Z0JBQ2IsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDN0IsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNULEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUNWLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0tBQzdCLENBQUM7Q0FDSDs7OztBQUtELE1BQU0sbUJBQXNCLEdBQU07SUFDaEMsTUFBTSxDQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0NBQzNDOzs7O0FBS0QsTUFBTSxlQUFlLElBQWdCLEVBQ2hCLEtBQWEsRUFDYixNQUFjLEVBQ2QsS0FBYztJQURkLHVCQUFBLEVBQUEsY0FBYztJQUNkLHNCQUFBLEVBQUEsY0FBYztJQUNqQyxJ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TSxLQUFLLENBQUMsQ0FBQyxDQUFDO0NBQ3pEOzs7O0FBS0QsTUFBTSxtQkFBbUIsQ0FBVztJQUNsQyxVQUFVLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0NBQ2xCOzs7O0FBS0QsTUFBTSxxQkFBcUIsR0FBUTtJQUNqQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQyxHQUFHLEVBQUUsQ0FBQztRQUNwQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3hCLE1BQU0sQ0FBQyxHQUFHLENBQUM7S0FDWixFQUFFLEVBQUcsQ0FBQyxDQUFDO0NBQ1Q7Ozs7QUFLRCxNQUFNLGdCQUFnQixHQUFXLEVBQ1gsR0FBVztJQUMvQixJQUFNLE9BQU8sR0FBRyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3JELElBQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0IsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQztDQUNoRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGUyYSB9IGZyb20gJy4vY29udmVydCc7XG5cbi8qKlxuICogQ29tbW9uIHV0aWxpdHkgZnVuY3Rpb25zXG4gKi9cblxuLyoqXG4gKiBTaW1wbGUgZGVib3VuY2U7IHVzZWZ1bCB3aGVuIG5vIHN0cmVhbSBpcyBhdCBwbGF5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWJvdW5jZShmdW5jOiBGdW5jdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0ID0gMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICBpbW1lZGlhdGUgPSBmYWxzZSk6IEZ1bmN0aW9uIHtcbiAgbGV0IHRpbWVvdXQgPSBudWxsO1xuICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgY29udGV4dCA9IHRoaXM7XG4gICAgY29uc3QgYXJncyA9IGFyZ3VtZW50cztcbiAgICBjb25zdCBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0O1xuICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICB0aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgaWYgKCFpbW1lZGlhdGUpXG4gICAgICAgIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgfSwgd2FpdCk7XG4gICAgaWYgKGNhbGxOb3cpXG4gICAgICBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICB9O1xufVxuXG4vKipcbiAqIERlZXAgY29weSBhbiBvYmplY3QsIGFsYmVpdCBub3QgdGVycmlibHkgZWZmaWNpZW50bHlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlZXBDb3B5PFQ+KG9iajogVCk6IFQge1xuICByZXR1cm4gPFQ+SlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTtcbn1cblxuLyoqXG4gKiBEdW1wIGJ1ZmZlclxuICovXG5leHBvcnQgZnVuY3Rpb24gZHVtcChkYXRhOiBVaW50OEFycmF5LFxuICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgIGViY2RpYyA9IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSAnYmx1ZScpOiB2b2lkIHtcbiAgY29uc3Qgc2xpY2VTaXplID0gMzI7XG4gIGxldCBvZmZzZXQgPSAwO1xuICBjb25zdCB0b3RhbCA9IGRhdGEubGVuZ3RoO1xuICBjb25zb2xlLmdyb3VwQ29sbGFwc2VkKGAlYyR7dGl0bGV9ICR7ZWJjZGljPyAnKEVCQ0RJQy1lbmNvZGVkKScgOiAnJ31gLCBgY29sb3I6ICR7Y29sb3J9YCk7XG4gIGNvbnNvbGUubG9nKCclYyAgICAgIDAwICAgICAgIDA0ICAgICAgIDA4ICAgICAgIDBjICAgICAgIDEwICAgICAgIDE0ICAgICAgIDE4ICAgICAgIDFjICAgICAgICAwMCAgMDQgIDA4ICAwYyAgMTAgIDE0ICAxOCAgMWMgICcsICdmb250LXdlaWdodDogYm9sZCcpO1xuICB3aGlsZSAodHJ1ZSkge1xuICAgIGNvbnN0IHNsaWNlID0gbmV3IFVpbnQ4QXJyYXkoZGF0YS5zbGljZShvZmZzZXQsIE1hdGgubWluKG9mZnNldCArIHNsaWNlU2l6ZSwgdG90YWwpKSk7XG4gICAgY29uc3Qge2hleCwgc3RyfSA9IGR1bXBTbGljZShzbGljZSwgc2xpY2VTaXplLCBlYmNkaWMpO1xuICAgIGNvbnNvbGUubG9nKGAlYyR7dG9IZXgob2Zmc2V0LCA0KX06ICVjJHtoZXh9ICVjJHtzdHJ9YCwgJ2ZvbnQtd2VpZ2h0OiBib2xkJywgJ2NvbG9yOiBibGFjaycsICdjb2xvcjogZ3JleScpO1xuICAgIC8vIHNldHVwIGZvciBuZXh0IHRpbWVcbiAgICBpZiAoc2xpY2UubGVuZ3RoIDwgc2xpY2VTaXplKVxuICAgICAgYnJlYWs7XG4gICAgb2Zmc2V0ICs9IHNsaWNlU2l6ZTtcbiAgfVxuICBjb25zb2xlLmdyb3VwRW5kKCk7XG59XG5cbmZ1bmN0aW9uIGR1bXBTbGljZShieXRlczogVWludDhBcnJheSxcbiAgICAgICAgICAgICAgICAgICBzbGljZVNpemU6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICBlYmNkaWM6IGJvb2xlYW4pOiB7aGV4LCBzdHJ9IHtcbiAgbGV0IGhleCA9ICcnO1xuICBsZXQgc3RyID0gJyc7XG4gIGxldCBpeCA9IDA7XG4gIC8vIGRlY29kZSB0byBoZXggYW5kIHN0cmluZyBlcXVpdlxuICBmb3IgKDsgaXggPCBieXRlcy5sZW5ndGg7IGl4KyspIHtcbiAgICBjb25zdCBieXRlID0gYnl0ZXNbaXhdO1xuICAgIGhleCArPSBgJHt0b0hleChieXRlLCAyKX1gO1xuICAgIGNvbnN0IGNoYXIgPSBlYmNkaWM/IGUyYShbYnl0ZV0pIDogU3RyaW5nLmZyb21DaGFyQ29kZShieXRlKTtcbiAgICAvLyBOT1RFOiB1c2Ugc3BlY2lhbCBjaGFyYWN0ZXIgaW4gc3RyaW5nIGFzIGEgdmlzdWFsIGFpZCB0byBjb3VudGluZ1xuICAgIHN0ciArPSAoKGNoYXIgPT09ICdcXHUwMGEwJykgfHwgKGNoYXIgPT09ICcgJykpPyAnXFx1MjAyMicgOiBjaGFyO1xuICAgIGlmICgoaXggPiAwKSAmJiAoKGl4ICUgNCkgPT09IDMpKVxuICAgICAgaGV4ICs9ICcgJztcbiAgfVxuICAvLyBwYWQgcmVtYWluZGVyIG9mIHNsaWNlXG4gIGZvciAoOyBpeCA8IHNsaWNlU2l6ZTsgaXgrKykge1xuICAgIGhleCArPSAnICAnO1xuICAgIHN0ciArPSAnICc7XG4gICAgaWYgKChpeCA+IDApICYmICgoaXggJSA0KSA9PT0gMykpXG4gICAgICBoZXggKz0gJyAnO1xuICB9XG4gIHJldHVybiB7aGV4LCBzdHJ9O1xufVxuXG4vKipcbiAqIElzIHRoaXMgb2JqZWN0IGVtcHR5P1xuICovXG5leHBvcnQgZnVuY3Rpb24gaXNPYmplY3RFbXB0eShvYmo6IGFueSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMob2JqKS5sZW5ndGggPT09IDApO1xufVxuXG4vKipcbiAqIFJ1biBjb2RlIG9uIG5leHQgdGlja1xuICovXG5leHBvcnQgZnVuY3Rpb24gbmV4dFRpY2soZjogRnVuY3Rpb24pOiB2b2lkIHtcbiAgc2V0VGltZW91dChmLCAwKTtcbn1cblxuLyoqXG4gKiBTaW1wbGUgbWFwIHJldmVyc2FsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXZlcnNlTWFwKG9iajogYW55KTogYW55IHtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikucmVkdWNlKChhY2MsIGspID0+IHtcbiAgICBhY2NbU3RyaW5nKG9ialtrXSldID0gaztcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7IH0pO1xufVxuXG4vKipcbiAqIENvbnZlcnQgdG8gaGV4LCB3aXRoIHBhZGRpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRvSGV4KG51bTogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgIHBhZDogbnVtYmVyKTogc3RyaW5nIHtcbiAgY29uc3QgcGFkZGluZyA9ICcwMDAwMDAwMDAwMDAwMDAwJy5zdWJzdHJpbmcoMCwgcGFkKTtcbiAgY29uc3QgaGV4ID0gbnVtLnRvU3RyaW5nKDE2KTtcbiAgcmV0dXJuIHBhZGRpbmcuc3Vic3RyaW5nKDAsIHBhZGRpbmcubGVuZ3RoIC0gaGV4Lmxlbmd0aCkgKyBoZXg7XG59XG4iXX0=