import { e2a } from './convert';
/**
 * Common utility functions
 */
/**
 * Simple debounce; useful when no stream is at play
 */
export function debounce(func, wait, immediate) {
    if (wait === void 0) { wait = 0; }
    if (immediate === void 0) { immediate = false; }
    var timeout = null;
    return function () {
        var context = this;
        var args = arguments;
        var callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(function () {
            timeout = null;
            if (!immediate)
                func.apply(context, args);
        }, wait);
        if (callNow)
            func.apply(context, args);
    };
}
/**
 * Deep copy an object, albeit not terribly efficiently
 */
export function deepCopy(obj) {
    return JSON.parse(JSON.stringify(obj));
}
/**
 * Dump buffer
 */
export function dump(data, title, ebcdic, color) {
    if (ebcdic === void 0) { ebcdic = false; }
    if (color === void 0) { color = 'blue'; }
    var sliceSize = 32;
    var offset = 0;
    var total = data.length;
    console.groupCollapsed("%c" + title + " " + (ebcdic ? '(EBCDIC-encoded)' : ''), "color: " + color);
    console.log('%c      00       04       08       0c       10       14       18       1c        00  04  08  0c  10  14  18  1c  ', 'font-weight: bold');
    while (true) {
        var slice = new Uint8Array(data.slice(offset, Math.min(offset + sliceSize, total)));
        var _a = dumpSlice(slice, sliceSize, ebcdic), hex = _a.hex, str = _a.str;
        console.log("%c" + toHex(offset, 4) + ": %c" + hex + " %c" + str, 'font-weight: bold', 'color: black', 'color: grey');
        // setup for next time
        if (slice.length < sliceSize)
            break;
        offset += sliceSize;
    }
    console.groupEnd();
}
function dumpSlice(bytes, sliceSize, ebcdic) {
    var hex = '';
    var str = '';
    var ix = 0;
    // decode to hex and string equiv
    for (; ix < bytes.length; ix++) {
        var byte = bytes[ix];
        hex += "" + toHex(byte, 2);
        var char = ebcdic ? e2a(new Uint8Array([byte])) : String.fromCharCode(byte);
        // NOTE: use special character in string as a visual aid to counting
        str += ((char === '\u00a0') || (char === ' ')) ? '\u2022' : char;
        if ((ix > 0) && ((ix % 4) === 3))
            hex += ' ';
    }
    // pad remainder of slice
    for (; ix < sliceSize; ix++) {
        hex += '  ';
        str += ' ';
        if ((ix > 0) && ((ix % 4) === 3))
            hex += ' ';
    }
    return { hex: hex, str: str };
}
/**
 * Is this object empty?
 */
export function isObjectEmpty(obj) {
    return (Object.getOwnPropertyNames(obj).length === 0);
}
/**
 * Run code on next tick
 */
export function nextTick(f) {
    setTimeout(f, 0);
}
/**
 * Simple map reversal
 */
export function reverseMap(obj) {
    return Object.keys(obj).reduce(function (acc, k) {
        acc[String(obj[k])] = k;
        return acc;
    }, {});
}
/**
 * Convert to hex, with padding
 */
export function toHex(num, pad) {
    var padding = '0000000000000000'.substring(0, pad);
    var hex = num.toString(16);
    return padding.substring(0, padding.length - hex.length) + hex;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbHMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLFdBQVcsQ0FBQzs7Ozs7OztBQVNoQyxNQUFNLG1CQUFtQixJQUFjLEVBQ2QsSUFBUSxFQUNSLFNBQWlCO0lBRGpCLHFCQUFBLEVBQUEsUUFBUTtJQUNSLDBCQUFBLEVBQUEsaUJBQWlCO0lBQ3hDLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQztJQUNuQixNQUFNLENBQUM7UUFDTCxJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDckIsSUFBTSxJQUFJLEdBQUcsU0FBUyxDQUFDO1FBQ3ZCLElBQU0sT0FBTyxHQUFHLFNBQVMsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUN0QyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdEIsT0FBTyxHQUFHLFVBQVUsQ0FBQztZQUNuQixPQUFPLEdBQUcsSUFBSSxDQUFDO1lBQ2YsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7Z0JBQ2IsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDN0IsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNULEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUNWLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0tBQzdCLENBQUM7Q0FDSDs7OztBQUtELE1BQU0sbUJBQXNCLEdBQU07SUFDaEMsTUFBTSxDQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0NBQzNDOzs7O0FBS0QsTUFBTSxlQUFlLElBQWdCLEVBQ2hCLEtBQWEsRUFDYixNQUFjLEVBQ2QsS0FBYztJQURkLHVCQUFBLEVBQUEsY0FBYztJQUNkLHNCQUFBLEVBQUEsY0FBYztJQUNqQyxJQUFNLFNBQVMsR0FBRyxFQUFFLENBQUM7SUFDckIsSUFBSSxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ2YsSUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUMxQixPQUFPLENBQUMsY0FBYyxDQUFDLE9BQUssS0FBSyxVQUFJLE1BQU0sQ0FBQSxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBRSxFQUFFLFlBQVUsS0FBTyxDQUFDLENBQUM7SUFDM0YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtSEFBbUgsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0lBQ3RKLE9BQU8sSUFBSSxFQUFFLENBQUM7UUFDWixJQUFNLEtBQUssR0FBRyxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RGLDhDQUFPLFlBQUcsRUFBRSxZQUFHLENBQXdDO1FBQ3ZELE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBSyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxZQUFPLEdBQUcsV0FBTSxHQUFLLEVBQUUsbUJBQW1CLEVBQUUsY0FBYyxFQUFFLGFBQWEsQ0FBQyxDQUFDOztRQUU1RyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztZQUMzQixLQUFLLENBQUM7UUFDUixNQUFNLElBQUksU0FBUyxDQUFDO0tBQ3JCO0lBQ0QsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO0NBQ3BCO0FBRUQsbUJBQW1CLEtBQWlCLEVBQ2pCLFNBQWlCLEVBQ2pCLE1BQWU7SUFDaEMsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ2IsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ2IsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDOztJQUVYLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQztRQUMvQixJQUFNLElBQUksR0FBRyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDdkIsR0FBRyxJQUFJLEtBQUcsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUcsQ0FBQztRQUMzQixJQUFNLElBQUksR0FBRyxNQUFNLENBQUEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQzs7UUFFN0UsR0FBRyxJQUFJLENBQUMsQ0FBQyxJQUFJLEtBQUssUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDaEUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUMvQixHQUFHLElBQUksR0FBRyxDQUFDO0tBQ2Q7O0lBRUQsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLEdBQUcsU0FBUyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFDNUIsR0FBRyxJQUFJLElBQUksQ0FBQztRQUNaLEdBQUcsSUFBSSxHQUFHLENBQUM7UUFDWCxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQy9CLEdBQUcsSUFBSSxHQUFHLENBQUM7S0FDZDtJQUNELE1BQU0sQ0FBQyxFQUFDLEdBQUcsS0FBQSxFQUFFLEdBQUcsS0FBQSxFQUFDLENBQUM7Q0FDbkI7Ozs7QUFLRCxNQUFNLHdCQUF3QixHQUFRO0lBQ2xDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUM7Q0FDekQ7Ozs7QUFLRCxNQUFNLG1CQUFtQixDQUFXO0lBQ2xDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Q0FDbEI7Ozs7QUFLRCxNQUFNLHFCQUFxQixHQUFRO0lBQ2pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ3BDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDeEIsTUFBTSxDQUFDLEdBQUcsQ0FBQztLQUNaLEVBQUUsRUFBRSxDQUFDLENBQUM7Q0FDUjs7OztBQUtELE1BQU0sZ0JBQWdCLEdBQVcsRUFDWCxHQUFXO0lBQy9CLElBQU0sT0FBTyxHQUFHLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDckQsSUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUM3QixNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFDO0NBQ2hFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZTJhIH0gZnJvbSAnLi9jb252ZXJ0JztcblxuLyoqXG4gKiBDb21tb24gdXRpbGl0eSBmdW5jdGlvbnNcbiAqL1xuXG4vKipcbiAqIFNpbXBsZSBkZWJvdW5jZTsgdXNlZnVsIHdoZW4gbm8gc3RyZWFtIGlzIGF0IHBsYXlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlYm91bmNlKGZ1bmM6IEZ1bmN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgIGltbWVkaWF0ZSA9IGZhbHNlKTogRnVuY3Rpb24ge1xuICBsZXQgdGltZW91dCA9IG51bGw7XG4gIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICBjb25zdCBjb250ZXh0ID0gdGhpcztcbiAgICBjb25zdCBhcmdzID0gYXJndW1lbnRzO1xuICAgIGNvbnN0IGNhbGxOb3cgPSBpbW1lZGlhdGUgJiYgIXRpbWVvdXQ7XG4gICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgdGltZW91dCA9IG51bGw7XG4gICAgICBpZiAoIWltbWVkaWF0ZSlcbiAgICAgICAgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICB9LCB3YWl0KTtcbiAgICBpZiAoY2FsbE5vdylcbiAgICAgIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gIH07XG59XG5cbi8qKlxuICogRGVlcCBjb3B5IGFuIG9iamVjdCwgYWxiZWl0IG5vdCB0ZXJyaWJseSBlZmZpY2llbnRseVxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVlcENvcHk8VD4ob2JqOiBUKTogVCB7XG4gIHJldHVybiA8VD5KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpO1xufVxuXG4vKipcbiAqIER1bXAgYnVmZmVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkdW1wKGRhdGE6IFVpbnQ4QXJyYXksXG4gICAgICAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgZWJjZGljID0gZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICBjb2xvciA9ICdibHVlJyk6IHZvaWQge1xuICBjb25zdCBzbGljZVNpemUgPSAzMjtcbiAgbGV0IG9mZnNldCA9IDA7XG4gIGNvbnN0IHRvdGFsID0gZGF0YS5sZW5ndGg7XG4gIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQoYCVjJHt0aXRsZX0gJHtlYmNkaWM/ICcoRUJDRElDLWVuY29kZWQpJyA6ICcnfWAsIGBjb2xvcjogJHtjb2xvcn1gKTtcbiAgY29uc29sZS5sb2coJyVjICAgICAgMDAgICAgICAgMDQgICAgICAgMDggICAgICAgMGMgICAgICAgMTAgICAgICAgMTQgICAgICAgMTggICAgICAgMWMgICAgICAgIDAwICAwNCAgMDggIDBjICAxMCAgMTQgIDE4ICAxYyAgJywgJ2ZvbnQtd2VpZ2h0OiBib2xkJyk7XG4gIHdoaWxlICh0cnVlKSB7XG4gICAgY29uc3Qgc2xpY2UgPSBuZXcgVWludDhBcnJheShkYXRhLnNsaWNlKG9mZnNldCwgTWF0aC5taW4ob2Zmc2V0ICsgc2xpY2VTaXplLCB0b3RhbCkpKTtcbiAgICBjb25zdCB7aGV4LCBzdHJ9ID0gZHVtcFNsaWNlKHNsaWNlLCBzbGljZVNpemUsIGViY2RpYyk7XG4gICAgY29uc29sZS5sb2coYCVjJHt0b0hleChvZmZzZXQsIDQpfTogJWMke2hleH0gJWMke3N0cn1gLCAnZm9udC13ZWlnaHQ6IGJvbGQnLCAnY29sb3I6IGJsYWNrJywgJ2NvbG9yOiBncmV5Jyk7XG4gICAgLy8gc2V0dXAgZm9yIG5leHQgdGltZVxuICAgIGlmIChzbGljZS5sZW5ndGggPCBzbGljZVNpemUpXG4gICAgICBicmVhaztcbiAgICBvZmZzZXQgKz0gc2xpY2VTaXplO1xuICB9XG4gIGNvbnNvbGUuZ3JvdXBFbmQoKTtcbn1cblxuZnVuY3Rpb24gZHVtcFNsaWNlKGJ5dGVzOiBVaW50OEFycmF5LFxuICAgICAgICAgICAgICAgICAgIHNsaWNlU2l6ZTogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgIGViY2RpYzogYm9vbGVhbik6IHtoZXgsIHN0cn0ge1xuICBsZXQgaGV4ID0gJyc7XG4gIGxldCBzdHIgPSAnJztcbiAgbGV0IGl4ID0gMDtcbiAgLy8gZGVjb2RlIHRvIGhleCBhbmQgc3RyaW5nIGVxdWl2XG4gIGZvciAoOyBpeCA8IGJ5dGVzLmxlbmd0aDsgaXgrKykge1xuICAgIGNvbnN0IGJ5dGUgPSBieXRlc1tpeF07XG4gICAgaGV4ICs9IGAke3RvSGV4KGJ5dGUsIDIpfWA7XG4gICAgY29uc3QgY2hhciA9IGViY2RpYz8gZTJhKG5ldyBVaW50OEFycmF5KFtieXRlXSkpIDogU3RyaW5nLmZyb21DaGFyQ29kZShieXRlKTtcbiAgICAvLyBOT1RFOiB1c2Ugc3BlY2lhbCBjaGFyYWN0ZXIgaW4gc3RyaW5nIGFzIGEgdmlzdWFsIGFpZCB0byBjb3VudGluZ1xuICAgIHN0ciArPSAoKGNoYXIgPT09ICdcXHUwMGEwJykgfHwgKGNoYXIgPT09ICcgJykpPyAnXFx1MjAyMicgOiBjaGFyO1xuICAgIGlmICgoaXggPiAwKSAmJiAoKGl4ICUgNCkgPT09IDMpKVxuICAgICAgaGV4ICs9ICcgJztcbiAgfVxuICAvLyBwYWQgcmVtYWluZGVyIG9mIHNsaWNlXG4gIGZvciAoOyBpeCA8IHNsaWNlU2l6ZTsgaXgrKykge1xuICAgIGhleCArPSAnICAnO1xuICAgIHN0ciArPSAnICc7XG4gICAgaWYgKChpeCA+IDApICYmICgoaXggJSA0KSA9PT0gMykpXG4gICAgICBoZXggKz0gJyAnO1xuICB9XG4gIHJldHVybiB7aGV4LCBzdHJ9O1xufVxuXG4vKipcbiAqIElzIHRoaXMgb2JqZWN0IGVtcHR5P1xuICovXG5leHBvcnQgZnVuY3Rpb24gaXNPYmplY3RFbXB0eShvYmo6IGFueSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMob2JqKS5sZW5ndGggPT09IDApO1xufVxuXG4vKipcbiAqIFJ1biBjb2RlIG9uIG5leHQgdGlja1xuICovXG5leHBvcnQgZnVuY3Rpb24gbmV4dFRpY2soZjogRnVuY3Rpb24pOiB2b2lkIHtcbiAgc2V0VGltZW91dChmLCAwKTtcbn1cblxuLyoqXG4gKiBTaW1wbGUgbWFwIHJldmVyc2FsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXZlcnNlTWFwKG9iajogYW55KTogYW55IHtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikucmVkdWNlKChhY2MsIGspID0+IHtcbiAgICBhY2NbU3RyaW5nKG9ialtrXSldID0gaztcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSk7XG59XG5cbi8qKlxuICogQ29udmVydCB0byBoZXgsIHdpdGggcGFkZGluZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gdG9IZXgobnVtOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgcGFkOiBudW1iZXIpOiBzdHJpbmcge1xuICBjb25zdCBwYWRkaW5nID0gJzAwMDAwMDAwMDAwMDAwMDAnLnN1YnN0cmluZygwLCBwYWQpO1xuICBjb25zdCBoZXggPSBudW0udG9TdHJpbmcoMTYpO1xuICByZXR1cm4gcGFkZGluZy5zdWJzdHJpbmcoMCwgcGFkZGluZy5sZW5ndGggLSBoZXgubGVuZ3RoKSArIGhleDtcbn1cbiJdfQ==